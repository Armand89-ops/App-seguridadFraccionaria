# üìö DOCUMENTACI√ìN COMPLETA - API BACKEND APLICACI√ìN DE TAREAS

## üéØ ¬øQU√â ES ESTE ARCHIVO?

Este documento explica **CADA L√çNEA DE C√ìDIGO** del backend para que cualquier persona pueda:
- ‚úÖ Entender c√≥mo funciona la aplicaci√≥n
- ‚úÖ Modificar y expandir funcionalidades
- ‚úÖ Crear su propia versi√≥n
- ‚úÖ Solucionar problemas
- ‚úÖ A√±adir nuevas caracter√≠sticas

---

## üèóÔ∏è ARQUITECTURA GENERAL

```
üì± React Native App ‚Üê‚Üí üåê API Backend ‚Üê‚Üí üóÉÔ∏è MongoDB Database
```

**Flujo de datos:**
1. Usuario interact√∫a con la app m√≥vil
2. App env√≠a peticiones HTTP al backend
3. Backend procesa y consulta la base de datos
4. Backend devuelve respuesta a la app
5. App muestra los resultados al usuario

---

## üìã √çNDICE DE CONTENIDOS

1. [Dependencias y Configuraci√≥n](#1-dependencias-y-configuraci√≥n)
2. [Configuraci√≥n del Servidor](#2-configuraci√≥n-del-servidor)
3. [Conexi√≥n a Base de Datos](#3-conexi√≥n-a-base-de-datos)
4. [Endpoints de Autenticaci√≥n](#4-endpoints-de-autenticaci√≥n)
5. [Endpoints de Tareas](#5-endpoints-de-tareas)
6. [Estructura de Datos](#6-estructura-de-datos)
7. [C√≥mo Expandir la API](#7-c√≥mo-expandir-la-api)
8. [Soluci√≥n de Problemas](#8-soluci√≥n-de-problemas)

---

## 1. DEPENDENCIAS Y CONFIGURACI√ìN

### üì¶ Paquetes Necesarios

```javascript
const express = require('express');        // Framework web para Node.js
const { MongoClient, ObjectId } = require('mongodb');  // Cliente y utilidades de MongoDB
const cors = require('cors');              // Middleware para permitir Cross-Origin Resource Sharing
```

**¬øPara qu√© sirve cada uno?**

- **Express**: Crea el servidor web y maneja las rutas (endpoints)
- **MongoDB**: Se conecta y opera con la base de datos
- **CORS**: Permite que React Native (puerto diferente) se comunique con el backend

### üîß Instalaci√≥n

```bash
npm install express mongodb cors
```

---

## 2. CONFIGURACI√ìN DEL SERVIDOR

### üöÄ Creaci√≥n del Servidor

```javascript
const app = express();                     // Crea la aplicaci√≥n Express
app.use(cors());                          // Permite peticiones desde React Native
app.use(express.json());                  // Permite recibir y parsear JSON
```

**¬øPor qu√© es importante?**

- **app.use(cors())**: Sin esto, React Native no puede comunicarse con el backend
- **app.use(express.json())**: Sin esto, no puedes recibir datos JSON en las peticiones

### üì° Puerto y Arranque

```javascript
app.listen(3000, () => {
  console.log('Servidor corriendo en puerto 3000');
});
```

**IMPORTANTE**: El puerto 3000 debe coincidir en:
- ‚úÖ Todas las URLs de React Native
- ‚úÖ Tu configuraci√≥n de red local

---

## 3. CONEXI√ìN A BASE DE DATOS

### üóÉÔ∏è Configuraci√≥n MongoDB

```javascript
const uri = "mongodb://localhost:27017";   // URL de conexi√≥n a MongoDB local
const client = new MongoClient(uri);       // Cliente para conectar con MongoDB

let db;                                    // Referencia a la base de datos
let coleccion;                            // Referencia a la colecci√≥n de usuarios

async function conectarDB() {
  await client.connect();                  // Establece conexi√≥n con MongoDB
  db = client.db("AplicacionTareas");      // Selecciona/crea la base de datos
  coleccion = db.collection("Usuarios");   // Selecciona/crea la colecci√≥n
}
conectarDB();
```

**¬øC√≥mo modificar para usar MongoDB Atlas (en la nube)?**

```javascript
// Cambiar esta l√≠nea:
const uri = "mongodb://localhost:27017";

// Por esta (con tu string de conexi√≥n de Atlas):
const uri = "mongodb+srv://usuario:password@cluster.mongodb.net/AplicacionTareas";
```

---

## 4. ENDPOINTS DE AUTENTICACI√ìN

### üîê LOGIN: POST /login

**¬øQu√© hace?** Verifica si un usuario existe y sus credenciales son correctas.

```javascript
app.post('/login', async (req, res) => {
  const { usuario, contrasena } = req.body;             // Extrae datos del cuerpo
  const resultado = await coleccion.findOne({ 
    usuario, 
    contrasena
  });                                                   // Busca usuario con esas credenciales
  
  if (resultado) {                                      // Si encuentra el usuario
    res.json({ 
      success: true, 
      mensaje: 'Logeado correctamente', 
      id: resultado._id                                 // Devuelve el ID para futuras operaciones
    });
  } else {                                              // Si no encuentra el usuario
    res.json({ 
      success: false, 
      mensaje: 'Usuario o contrase√±a incorrectos' 
    });
  }
});
```

**Petici√≥n desde React Native:**
```javascript
const response = await fetch('http://192.168.0.112:3000/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ usuario: "miusuario", contrasena: 12345 }),
});
```

**üîß C√≥mo mejorar la seguridad:**

```javascript
// 1. Hashear contrase√±as con bcrypt
const bcrypt = require('bcrypt');

// En registro:
const hashedPassword = await bcrypt.hash(contrasena, 10);

// En login:
const isValid = await bcrypt.compare(contrasena, resultado.contrasena);
```

### üìù REGISTRO: POST /registrar

**¬øQu√© hace?** Crea un nuevo usuario en la base de datos.

```javascript
app.post('/registrar', async (req, res) => {
  const { usuario, contrasena } = req.body;             // Extrae datos del nuevo usuario
  const resultado = await coleccion.insertOne({ 
    usuario, 
    contrasena 
  });                                                   // Inserta el nuevo usuario
  
  if (resultado.acknowledged) {                         // Si MongoDB confirma la inserci√≥n
    res.json({ 
      success: true, 
      mensaje: 'Usuario registrado correctamente' 
    });
  } else {                                              // Si hay error
    res.json({ 
      success: false, 
      mensaje: 'Error al registrar el usuario' 
    });
  }
});
```

**üîß C√≥mo validar usuarios √∫nicos:**

```javascript
app.post('/registrar', async (req, res) => {
  const { usuario, contrasena } = req.body;
  
  // Verificar si el usuario ya existe
  const usuarioExistente = await coleccion.findOne({ usuario });
  if (usuarioExistente) {
    return res.json({ 
      success: false, 
      mensaje: 'El usuario ya existe' 
    });
  }
  
  // Continuar con el registro...
});
```

---

## 5. ENDPOINTS DE TAREAS

### üìã OBTENER TAREAS: GET /tareas

**¬øQu√© hace?** Recupera todas las tareas de un usuario espec√≠fico.

```javascript
app.get('/tareas', async (req, res) => {
  const { id } = req.query;                             // Extrae ID del usuario de la URL
  const tareas = await db.collection('Tareas').find({ 
    idUsuario: new ObjectId(id)                         // Busca tareas de este usuario
  }).toArray();                                         // Convierte a array
  res.json(tareas);                                     // Devuelve las tareas
});
```

**URL de ejemplo:** `GET http://localhost:3000/tareas?id=60f7d2e9e8b8a12345678901`

**üîß C√≥mo a√±adir filtros:**

```javascript
app.get('/tareas', async (req, res) => {
  const { id, estado, limite } = req.query;
  
  let filtro = { idUsuario: new ObjectId(id) };
  
  // Filtrar por estado si se proporciona
  if (estado && estado !== 'Todas') {
    filtro.Estado = estado;
  }
  
  let query = db.collection('Tareas').find(filtro);
  
  // Limitar resultados si se proporciona
  if (limite) {
    query = query.limit(parseInt(limite));
  }
  
  const tareas = await query.toArray();
  res.json(tareas);
});
```

### üìÑ OBTENER UNA TAREA: GET /tarea

**¬øQu√© hace?** Recupera los detalles de una tarea espec√≠fica (para edici√≥n).

```javascript
app.get('/tarea', async (req, res) => {
  const { id } = req.query;                             // Extrae ID de la tarea
  const tarea = await db.collection('Tareas').findOne({ 
    _id: new ObjectId(id)                               // Busca por ID √∫nico
  });
  
  if (tarea) {                                          // Si encuentra la tarea
    res.json(tarea);                                    // Devuelve los datos
  } else {                                              // Si no la encuentra
    res.status(404).json({ 
      mensaje: 'Tarea no encontrada' 
    });
  }
});
```

### ‚ûï CREAR TAREA: POST /AgregarTareas

**¬øQu√© hace?** A√±ade una nueva tarea a la base de datos.

```javascript
app.post('/AgregarTareas', async (req, res) => {
  const { idUsuario, TituloTarea, DescripTarea, Estado } = req.body;
  
  await db.collection('Tareas').insertOne({             // Inserta nueva tarea
    idUsuario: new ObjectId(idUsuario),                 // Relaci√≥n con el usuario
    TituloTarea,                                        // T√≠tulo (m√°x 20 chars)
    DescripTarea,                                       // Descripci√≥n (m√°x 100 chars)
    Estado                                              // "Pendiente" o "Completada"
  });
  
  res.json({ 
    success: true, 
    mensaje: 'Tarea agregada' 
  });
});
```

**üîß C√≥mo a√±adir timestamp autom√°tico:**

```javascript
await db.collection('Tareas').insertOne({
  idUsuario: new ObjectId(idUsuario),
  TituloTarea,
  DescripTarea,
  Estado,
  fechaCreacion: new Date(),                            // Fecha actual
  fechaModificacion: new Date()
});
```

### ‚úèÔ∏è EDITAR TAREA: POST /editarTarea

**¬øQu√© hace?** Modifica una tarea existente.

```javascript
app.post('/editarTarea', async (req, res) => {
  const { id, TituloTarea, DescripTarea, Estado } = req.body;
  
  const resultado = await db.collection('Tareas').updateOne(
    { _id: new ObjectId(id) },                          // Encuentra la tarea
    { $set: { TituloTarea, DescripTarea, Estado } }     // Actualiza campos
  );
  
  if (resultado.modifiedCount === 1) {                  // Si se modific√≥
    res.json({ success: true, mensaje: 'Tarea editada' });
  } else {                                              // Si no se modific√≥
    res.json({ success: false, mensaje: 'No se pudo editar la tarea' });
  }
});
```

**üîß C√≥mo a√±adir fecha de modificaci√≥n:**

```javascript
const resultado = await db.collection('Tareas').updateOne(
  { _id: new ObjectId(id) },
  { 
    $set: { 
      TituloTarea, 
      DescripTarea, 
      Estado,
      fechaModificacion: new Date()                     // Actualizar timestamp
    } 
  }
);
```

### üóëÔ∏è ELIMINAR TAREA: POST /eliminarTarea

**¬øQu√© hace?** Borra permanentemente una tarea.

```javascript
app.post('/eliminarTarea', async (req, res) => {
  const { id } = req.body;                              // ID de la tarea a eliminar
  
  const resultado = await db.collection('Tareas').deleteOne({ 
    _id: new ObjectId(id)                               // Elimina por ID
  });
  
  if (resultado.deletedCount === 1) {                   // Si se elimin√≥
    res.json({ success: true, mensaje: 'Tarea eliminada' });
  } else {                                              // Si no se elimin√≥
    res.json({ success: false, mensaje: 'No se pudo eliminar la tarea' });
  }
});
```

**üîß Soft Delete (marcar como eliminada sin borrar):**

```javascript
// En lugar de deleteOne, usar updateOne:
const resultado = await db.collection('Tareas').updateOne(
  { _id: new ObjectId(id) },
  { 
    $set: { 
      eliminada: true,
      fechaEliminacion: new Date()
    } 
  }
);

// Y modificar las consultas para excluir eliminadas:
const tareas = await db.collection('Tareas').find({ 
  idUsuario: new ObjectId(id),
  eliminada: { $ne: true }                              // No eliminadas
}).toArray();
```

---

## 6. ESTRUCTURA DE DATOS

### üë§ Colecci√≥n "Usuarios"

```javascript
{
  _id: ObjectId("60f7d2e9e8b8a12345678901"),           // ID √∫nico generado por MongoDB
  usuario: "miusuario",                                 // Nombre de usuario (string)
  contrasena: 12345                                     // Contrase√±a (number)
}
```

### üìã Colecci√≥n "Tareas"

```javascript
{
  _id: ObjectId("60f7d2e9e8b8a12345678902"),           // ID √∫nico de la tarea
  idUsuario: ObjectId("60f7d2e9e8b8a12345678901"),     // Referencia al usuario
  TituloTarea: "Completar proyecto",                    // T√≠tulo (m√°x 20 caracteres)
  DescripTarea: "Terminar la aplicaci√≥n de tareas...", // Descripci√≥n (m√°x 100 caracteres)
  Estado: "Pendiente"                                   // "Pendiente" o "Completada"
}
```

---

## 7. C√ìMO EXPANDIR LA API

### üè∑Ô∏è A√±adir Categor√≠as a las Tareas

1. **Modificar estructura de datos:**
```javascript
{
  // ... campos existentes
  categoria: "Trabajo",                                 // Nueva campo
  prioridad: "Alta",                                    // Otro campo nuevo
  fechaLimite: new Date("2025-12-31")                  // Fecha l√≠mite
}
```

2. **Modificar endpoint de creaci√≥n:**
```javascript
app.post('/AgregarTareas', async (req, res) => {
  const { idUsuario, TituloTarea, DescripTarea, Estado, categoria, prioridad } = req.body;
  
  await db.collection('Tareas').insertOne({
    idUsuario: new ObjectId(idUsuario),
    TituloTarea,
    DescripTarea,
    Estado,
    categoria: categoria || "General",                  // Valor por defecto
    prioridad: prioridad || "Media",                    // Valor por defecto
    fechaCreacion: new Date()
  });
  
  res.json({ success: true, mensaje: 'Tarea agregada' });
});
```

3. **A√±adir filtros por categor√≠a:**
```javascript
app.get('/tareas', async (req, res) => {
  const { id, estado, categoria } = req.query;
  
  let filtro = { idUsuario: new ObjectId(id) };
  
  if (estado && estado !== 'Todas') {
    filtro.Estado = estado;
  }
  
  if (categoria && categoria !== 'Todas') {
    filtro.categoria = categoria;
  }
  
  const tareas = await db.collection('Tareas').find(filtro).toArray();
  res.json(tareas);
});
```

### üîç A√±adir B√∫squeda de Tareas

```javascript
app.get('/buscar-tareas', async (req, res) => {
  const { id, termino } = req.query;
  
  const tareas = await db.collection('Tareas').find({
    idUsuario: new ObjectId(id),
    $or: [
      { TituloTarea: { $regex: termino, $options: 'i' } },      // Buscar en t√≠tulo
      { DescripTarea: { $regex: termino, $options: 'i' } }      // Buscar en descripci√≥n
    ]
  }).toArray();
  
  res.json(tareas);
});
```

### üìä A√±adir Estad√≠sticas

```javascript
app.get('/estadisticas', async (req, res) => {
  const { id } = req.query;
  
  const total = await db.collection('Tareas').countDocuments({
    idUsuario: new ObjectId(id)
  });
  
  const pendientes = await db.collection('Tareas').countDocuments({
    idUsuario: new ObjectId(id),
    Estado: "Pendiente"
  });
  
  const completadas = await db.collection('Tareas').countDocuments({
    idUsuario: new ObjectId(id),
    Estado: "Completada"
  });
  
  res.json({
    total,
    pendientes,
    completadas,
    porcentajeCompletado: total > 0 ? (completadas / total * 100).toFixed(1) : 0
  });
});
```

---

## 8. SOLUCI√ìN DE PROBLEMAS

### üö® Errores Comunes y Soluciones

#### "Cannot connect to MongoDB"

**Problema:** MongoDB no est√° ejecut√°ndose
**Soluci√≥n:**
```bash
# En Windows (desde CMD como administrador):
net start MongoDB

# En macOS/Linux:
sudo systemctl start mongod
```

#### "CORS Error" en React Native

**Problema:** Falta configuraci√≥n CORS
**Soluci√≥n:** Verificar que tienes `app.use(cors());` en el servidor

#### "Cannot read property 'find' of undefined"

**Problema:** La conexi√≥n a la base de datos no se estableci√≥
**Soluci√≥n:** Verificar que `conectarDB()` se ejecute correctamente

#### "Invalid ObjectId"

**Problema:** El ID enviado no es un ObjectId v√°lido
**Soluci√≥n:**
```javascript
// Validar ObjectId antes de usar:
const { ObjectId } = require('mongodb');

if (!ObjectId.isValid(id)) {
  return res.status(400).json({ mensaje: 'ID inv√°lido' });
}
```

### üîß Comandos √ötiles

#### Instalar dependencias:
```bash
npm install express mongodb cors
```

#### Ejecutar el servidor:
```bash
node index.js
```

#### Verificar que funciona:
```bash
# En el navegador:
http://localhost:3000

# Deber√≠a mostrar: "API de AplicacionTareas funcionando"
```

#### Ver logs de MongoDB:
```bash
# En otra terminal:
mongod --verbose
```

### üì± Configuraci√≥n de Red para React Native

#### Para emulador:
```javascript
// Usar localhost:
const URL = "http://localhost:3000";
```

#### Para dispositivo f√≠sico:
```javascript
// Usar IP local (encontrar con ipconfig o ifconfig):
const URL = "http://192.168.0.112:3000";
```

---

## üöÄ PR√ìXIMOS PASOS

Con esta documentaci√≥n ya puedes:

1. ‚úÖ **Entender** cada l√≠nea del c√≥digo backend
2. ‚úÖ **Modificar** funcionalidades existentes  
3. ‚úÖ **A√±adir** nuevas caracter√≠sticas
4. ‚úÖ **Solucionar** problemas comunes
5. ‚úÖ **Expandir** la API seg√∫n tus necesidades

### üéØ Ideas para Expandir:

- üîê **Autenticaci√≥n JWT** para mayor seguridad
- üìß **Sistema de notificaciones** por email
- üì± **Push notifications** para recordatorios
- üåê **Deploy en la nube** (Heroku, Railway, etc.)
- üìä **Dashboard web** para administraci√≥n
- üîÑ **Sincronizaci√≥n offline** con React Native
- üè∑Ô∏è **Sistema de etiquetas** y categor√≠as avanzadas
- üë• **Tareas compartidas** entre usuarios
- üìà **Reportes y gr√°ficas** de productividad

¬°Ahora tienes todo lo necesario para crear tu propia aplicaci√≥n personalizada! üéâ
